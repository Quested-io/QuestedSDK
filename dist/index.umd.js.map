{"version":3,"file":"index.umd.js","sources":["../src/config/index.ts","../src/utils/Logger.service.ts","../src/utils/Bridge.service.ts","../src/api/Player.service.ts","../src/create.ts","../src/index.ts"],"sourcesContent":["const CONFIG_INJECT_KEY = Symbol('CONFIG_INJECT_KEY');\n\nexport { CONFIG_INJECT_KEY };\n","import { inject, injectable } from 'inversify';\nimport { LogLevel } from '../types/LogLevel';\nimport { CONFIG_INJECT_KEY } from '../config';\nimport { InitOptions } from '../types/InitOptions';\nimport { ILogger } from '../types/ILogger';\n\nconst logLevelOrder: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  log: 2,\n  warn: 3,\n  error: 4,\n};\n\n@injectable()\nexport class LoggerService {\n  private readonly logLevel: LogLevel;\n  private logger: ILogger;\n\n  constructor(\n    @inject(CONFIG_INJECT_KEY)\n    private options: InitOptions,\n  ) {\n    this.logLevel = this.options.logLevel ?? 'log';\n    this.logger = this.options.logger ?? console;\n  }\n\n  debug(...args: any[]) {\n    if (logLevelOrder[this.logLevel] <= logLevelOrder.debug) {\n      this.logger.debug(...args);\n    }\n  }\n\n  info(...args: any[]) {\n    if (logLevelOrder[this.logLevel] <= logLevelOrder.info) {\n      this.logger.info(...args);\n    }\n  }\n\n  log(...args: any[]) {\n    if (logLevelOrder[this.logLevel] <= logLevelOrder.log) {\n      this.logger.log(...args);\n    }\n  }\n\n  warn(...args: any[]) {\n    if (logLevelOrder[this.logLevel] <= logLevelOrder.warn) {\n      this.logger.warn(...args);\n    }\n  }\n\n  error(...args: any[]) {\n    if (logLevelOrder[this.logLevel] <= logLevelOrder.error) {\n      this.logger.error(...args);\n    }\n  }\n}\n","import { inject, injectable } from 'inversify';\nimport { LoggerService } from './Logger.service';\n\n@injectable()\nexport class BridgeService {\n  private readonly TIMEOUT_MS = 5000;\n\n  constructor(\n    @inject(LoggerService)\n    private logger: LoggerService,\n  ) {}\n\n  async send(activityId: string, eventType: string, payload: any) {\n    this.logger.log(activityId, eventType, payload);\n    window.parent.postMessage(\n      {\n        type: eventType,\n        source: activityId,\n        payload: payload,\n      },\n      '*',\n    );\n  }\n\n  waitForReply(activityId: string, eventType: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const listener = (event: MessageEvent) => {\n        if (event.data.type === eventType && event.data.source === activityId) {\n          cleanup();\n          resolve(event.data.payload);\n        }\n      };\n\n      const timeout = setTimeout(() => {\n        cleanup();\n        reject(\n          new Error(\n            `Timeout waiting for reply to ${eventType} after ${this.TIMEOUT_MS}ms`,\n          ),\n        );\n      }, this.TIMEOUT_MS);\n\n      const cleanup = () => {\n        window.removeEventListener('message', listener);\n        clearTimeout(timeout);\n      };\n\n      window.addEventListener('message', listener);\n    });\n  }\n\n  async sendAndWaitForReply(\n    activityId: string,\n    eventType: string,\n    payload: any,\n  ): Promise<any> {\n    await this.send(activityId, eventType, payload);\n    return this.waitForReply(activityId, eventType);\n  }\n}\n","import { inject, injectable } from 'inversify';\nimport type { ActivityEventType, PlayerApi } from '../types/api/Player.api';\nimport type { IProfile } from '../types/entities/IProfile';\nimport { BridgeService } from '../utils/Bridge.service';\nimport { CONFIG_INJECT_KEY } from '../config';\nimport type { InitOptions } from '../types/InitOptions';\nimport type {IList} from \"../types/entities/IList\";\n\n@injectable()\nexport class PlayerService implements PlayerApi {\n  constructor(\n    @inject(BridgeService)\n    private bridgeService: BridgeService,\n    @inject(CONFIG_INJECT_KEY)\n    private options: InitOptions,\n  ) {}\n\n  async me(): Promise<IProfile> {\n    return this.bridgeService.sendAndWaitForReply(\n      this.options.activityId,\n      'getProfile',\n      {},\n    );\n  }\n  async trackEvent(event: ActivityEventType, data: any): Promise<void> {\n    return this.bridgeService.send(this.options.activityId, event, data);\n  }\n  updateProfileSpecification(id: string, value: string): Promise<void> {\n    return this.bridgeService.send(\n      this.options.activityId,\n      'system:updateProfileSpecification',\n      { id, value },\n    );\n  }\n  getGameProperty(key: string): Promise<string> {\n    return this.bridgeService.sendAndWaitForReply(\n      this.options.activityId,\n      'system:getGameProperty',\n      { key },\n    );\n  }\n  setGameProperty(key: string, value: string): Promise<void> {\n    return this.bridgeService.send(\n      this.options.activityId,\n      'system:setGameProperty',\n      { key, value },\n    );\n  }\n  getAllLists(): Promise<IList[]> {\n    return this.bridgeService.sendAndWaitForReply(\n      this.options.activityId,\n      'system:getAllLists',\n      {},\n    );\n  }\n  removeFromList(listId: string, itemId: string): Promise<void> {\n    return this.bridgeService.send(\n      this.options.activityId,\n      'system:removeFromList',\n      { listId, itemId },\n    );\n  }\n  addToList(listId: string, itemId: string): Promise<void> {\n    return this.bridgeService.send(\n      this.options.activityId,\n      'system:addToList',\n      { listId, itemId },\n    );\n  }\n}\n","import { Container } from 'inversify';\nimport type {Instance} from './types/Instance';\nimport { PlayerService } from './api/Player.service';\nimport type {InitOptions} from './types/InitOptions';\nimport { CONFIG_INJECT_KEY } from './config';\nimport { LoggerService } from './utils/Logger.service';\nimport type {OnInstanceInit} from './types/OnInstanceInit';\n\nconst Components: any[] = [\n  PlayerService,\n  LoggerService,\n];\n\nexport const create = (options: InitOptions): Instance => {\n  let isInitialized = false;\n\n  const container = new Container();\n  container.bind(CONFIG_INJECT_KEY).toConstantValue(options);\n\n  for (const provider of Components) {\n    container.bind(provider).toSelf().inSingletonScope();\n  }\n  handleInstanceInitForComponent(container, Components).then(() => {\n    options.onReady?.();\n    isInitialized = true;\n  });\n  return {\n    _container: container,\n    api: {\n      player: container.get(PlayerService),\n    },\n    isInitialized: () => isInitialized,\n  };\n};\n\nconst handleInstanceInitForComponent = async (\n  container: Container,\n  components: any[],\n) => {\n  for (const provider of components) {\n    const component = container.get<OnInstanceInit>(provider);\n    if (component.onInstanceInit) {\n      await component.onInstanceInit();\n    }\n  }\n};\n","import 'reflect-metadata';\nimport { create } from './create';\nimport type {Instance} from './types/Instance';\nimport type {InitOptions} from './types/InitOptions';\nimport {\n  ActivityEventData,\n  ActivityEventType,\n  MatchEndedEventData,\n  RouteChangedEventData,\n} from './types/api/Player.api';\n\nlet instance: Instance;\n\nconst init = (options: InitOptions) => {\n  instance = create(options);\n};\n\nexport { init, create, instance };\nexport type {Instance, InitOptions, ActivityEventType, ActivityEventData, MatchEndedEventData, RouteChangedEventData};"],"names":["injectable","inject","Container","instance"],"mappings":"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"}